<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================ -->
    <!-- ACTION FIRST - Must be defined before reference -->
    <!-- ============================================ -->
    <record id="action_create_employee_appraisal" model="ir.actions.act_window">
        <field name="name">Create Appraisal</field>
        <field name="res_model">hr.employee.appraisal</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_employee_id': active_id}</field>
    </record>

    <!-- ============================================ -->
    <!-- NOW Add Appraisal Tab to Employee Form -->
    <!-- ============================================ -->
    <record id="view_employee_form_appraisal_tab" model="ir.ui.view">
        <field name="name">hr.employee.form.appraisal.tab</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <!-- Add Appraisal Tab -->
            <xpath expr="//notebook" position="inside">
                <page string="Appraisal" name="appraisal" groups="hr.group_hr_user">
                    <group>
                        <button name="%(action_create_employee_appraisal)d" 
                                type="action" 
                                string="Create New Appraisal" 
                                class="btn-primary"
                                icon="fa-plus"
                                context="{'default_employee_id': id}"/>
                    </group>
                    
                    <group string="Appraisal Records">
                        <field name="appraisal_ids" nolabel="1">
                            <form string="Employee Appraisal">
                                <sheet>
                                    <div class="oe_title">
                                        <h1>
                                            <field name="name" readonly="1"/>
                                        </h1>
                                    </div>
                                    
                                    <group>
                                        <group string="Employee Information">
                                            <field name="employee_id" readonly="1"/>
                                        </group>
                                    </group>
                                    
                                    <group string="ðŸ“‹ Auto-Detected Configuration" 
                                           class="alert alert-info">
                                        <group>
                                            <field name="appraisal_team_id" readonly="1"/>
                                            <field name="template_type" readonly="1"/>
                                        </group>
                                        <group>
                                            <field name="okr_template_id" 
                                                   invisible="template_type != 'okr'" 
                                                   readonly="1"/>
                                            <field name="ninebox_template_id" 
                                                   invisible="template_type != 'ninebox'" 
                                                   readonly="1"/>
                                        </group>
                                    </group>
                                    
                                    <group string="âš™ï¸ Select Evaluation Type">
                                        <field name="evaluation_type" widget="radio" required="1"/>
                                    </group>
                                    
                                    <group string="ðŸ“Š Evaluation Criteria" 
                                           invisible="not evaluation_type">
                                        <field name="criteria_data" 
                                               nolabel="1" 
                                               readonly="1" 
                                               widget="html"/>
                                    </group>
                                </sheet>
                            </form>
                            
                            <list string="Appraisals">
                                <field name="name"/>
                                <field name="appraisal_team_id"/>
                                <field name="template_type" widget="badge"/>
                                <field name="evaluation_type" widget="badge"/>
                                <field name="create_date"/>
                            </list>
                        </field>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>